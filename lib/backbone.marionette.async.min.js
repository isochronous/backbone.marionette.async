// Backbone.Marionette.Async, v0.2.0
// Copyright (c)2012 Derick Bailey, Muted Solutions, LLC.
// Distributed under MIT license
// http://github.com/derickbailey/backbone.marionette.async
Backbone.Marionette.Async=function(e,t,n,r){var i={init:function(){t.Renderer=i.Renderer,n.extend(t.ItemView.prototype,i.ItemView),n.extend(t.CollectionView.prototype,i.CollectionView),n.extend(t.CompositeView.prototype,i.CompositeView),n.extend(t.Region.prototype,i.Region)}};return i.ItemView={render:function(e){var n=this,i=r.Deferred();e=e||{},this.isClosed=!1;var s=function(){n.triggerMethod("before:render",n),n.triggerMethod("item:before:render",n);var i=n.getTemplate(),s=t.Renderer.render(i,n,e);r.when(s).then(o)},o=function(t){!e.replace&&!e.update&&n.$el.html(t),n.bindUIElements(),u()},u=function(){n.triggerMethod("render",n),n.triggerMethod("item:rendered",n),i.resolve()};return i.promise()}},i.CollectionView={render:function(e){var t=this,n=r.Deferred(),i;e=e||{},e.replace=!1,this.isClosed=!1,this.triggerBeforeRender(),this.renderOptions=e,this.closeEmptyView(),this.closeChildren();if(this.collection&&this.collection.length>0)i=this.showCollection();else{var s=this.showEmptyView();i=[s]}return n.done(function(){t.triggerRendered()}),r.when.apply(this,i).then(function(){n.resolveWith(t)}),n.promise()},showCollection:function(){var e=this,t=[],n;return this.collection.each(function(r,i){n=e.getItemView();var s=e.addItemView(r,n,i);t.push(s)}),t},showEmptyView:function(n){var r,i=t.getOption(this,"emptyView");if(i&&!this._showingEmptyView){this._showingEmptyView=!0;var s=new e.Model;r=this.addItemView(s,i,0)}return r},renderItemView:function(e,t){var n=this,i=e.render(this.renderOptions);return r.when(i).then(function(){n.appendHtml(n,e,t)}),i}},i.CompositeView={render:function(e){var t=this,n=r.Deferred();e=e||{},this.isClosed=!1,this.resetItemViewContainer();var i=this.renderModel(e);return r.when(i).then(function(e){t.$el.html(e),t.bindUIElements(),t.triggerMethod("composite:model:rendered");var i=t.renderCollection();r.when(i).then(function(){n.resolve()})}),n.done(function(){t.triggerMethod("render"),t.triggerMethod("composite:rendered")}),n.promise()},renderModel:function(e){var n=this.getTemplate();return e=e||{},t.Renderer.render(n,this,e)},renderCollection:function(){var e=t.CollectionView.prototype.render.apply(this,arguments);return e.done(function(){this.triggerMethod("composite:collection:rendered")}),e.promise()}},i.Region={show:function(e,n){var i=this,s,o=r.Deferred();n=n||{};var u=function(){i.open(e),t.triggerMethod.call(e,"show"),t.triggerMethod.call(i,"show",e),o.resolve()};return this.ensureEl(),this.close(),s=e.render(n),r.when(s).then(u),this.currentView=e,o.promise()}},i.Renderer={render:function(e,t,r){var i={replace:!1,update:!1};return n.extend(i,r),i.replace===!0?e.view(t,!0):e.html(t.$el,t,i.update)}},i.init(),i}(Backbone,Backbone.Marionette,_,window.jQuery||window.Zepto||window.ender);