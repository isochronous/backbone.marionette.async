// Backbone.Marionette.Async, v0.2.0
// Copyright (c)2012 Derick Bailey, Muted Solutions, LLC.
// Distributed under MIT license
// http://github.com/derickbailey/backbone.marionette.async
Backbone.Marionette.Async=function(e,t,n,r){var i={init:function(){t.Renderer=i.Renderer,n.extend(t.ItemView.prototype,i.ItemView),n.extend(t.CollectionView.prototype,i.CollectionView),n.extend(t.CompositeView.prototype,i.CompositeView),n.extend(t.Region.prototype,i.Region)}};i.ItemView={render:function(e){var n=this,i=e||{},o=r.Deferred(),u=function(){n.triggerMethod("before:render",n),n.triggerMethod("item:before:render",n);var e=n.serializeData();r.when(e).then(a)},a=function(e){var s=n.getTemplate(),o=t.Renderer.render(s,n,i);r.when(o).then(f)},f=function(e){!i.replace&&!i.update&&n.$el.html(e),n.bindUIElements(),s(n.onRender,l,n)},l=function(){n.triggerMethod("render",n),n.triggerMethod("item:rendered",n),o.resolve()};return s(this.beforeRender,u,this),o.promise()}},i.CollectionView={render:function(e){var t=this,i=r.Deferred(),s,o=e||{};o=n.extend(o,{replace:!1}),this.isClosed=!1,this.triggerBeforeRender(),this.renderOptions=o,this.closeEmptyView(),this.closeChildren();if(this.collection&&this.collection.length>0)s=this.showCollection();else{var u=this.showEmptyView();s=[u]}return i.done(function(){t.triggerRendered()}),r.when.apply(this,s).then(function(){i.resolveWith(t)}),i.promise()},showCollection:function(){var e=this,t=[],n=this.getItemView();return this.collection.each(function(r,i){var s=e.addItemView(r,n,i);t.push(s)}),t},showEmptyView:function(t){var n,r=this.options.emptyView||this.emptyView;if(r&&!this._showingEmptyView){this._showingEmptyView=!0;var i=new e.Model;n=this.addItemView(i,r,0)}return n},renderItemView:function(e,t){var n=this,i=e.render(this.renderOptions);return r.when(i).then(function(){n.appendHtml(n,e,t)}),i}},i.CompositeView={render:function(e){var t=this,n=e||{},i=r.Deferred();this.isClosed=!1,this.resetItemViewContainer();var s=this.renderModel(n);return r.when(s).then(function(e){t.$el.html(e),t.bindUIElements(),t.triggerMethod("composite:model:rendered"),t.triggerMethod("render");var n=t.renderCollection();r.when(n).then(function(){i.resolve()})}),i.done(function(){t.triggerMethod("composite:rendered")}),i.promise()},renderModel:function(e){var n=this.getTemplate(),r=e||{};return t.Renderer.render(n,this,r)},renderCollection:function(){var e=t.CollectionView.prototype.render.apply(this,arguments);return e.done(function(){this.triggerMethod("composite:collection:rendered")}),e.promise()}},i.Region={show:function(e,n){var i=this,s=n||{},o=r.Deferred();return this.ensureEl(),this.close(),r.when(e.render(s)).then(function(){i.open(e),t.triggerMethod.call(e,"show"),t.triggerMethod.call(i,"show",e),o.resolve()}),this.currentView=e,o.promise()}},i.Renderer={render:function(e,t,r){var i={replace:!1,update:!1};return i=n.extend(i,r),i.replace===!0?e.view(t,!0):e.html(t.$el,t,i.update)}};var s=function(e,t,i){var s;e&&(s=e.call(i)),r.when(s).then(n.bind(t,i))};return i.init(),i}(Backbone,Backbone.Marionette,_,window.jQuery||window.Zepto||window.ender);