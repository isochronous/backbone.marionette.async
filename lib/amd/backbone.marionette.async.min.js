// Backbone.Marionette.Async, v0.3.0
// Copyright (c)2013 Derick Bailey, Muted Solutions, LLC.
// Distributed under MIT license
// http://github.com/marionettejs/backbone.marionette.async
//
// Backbone.Marionette.Async updated to 1.0.0 Beta 3 code base by Jeremy McLeod
// http://github.com/isochronous
(function(e,t){if(typeof exports=="object"){var n=require("jquery"),r=require("underscore"),i=require("backbone");module.exports=t(n,r,i)}else typeof define=="function"&&define.amd&&define(["jquery","underscore","backbone"],t)})(this,function(e,t,n){return n.Marionette.Async=function(e,t,n,r){var i={init:function(){t.Renderer=i.Renderer,n.extend(t.ItemView.prototype,i.ItemView),n.extend(t.CollectionView.prototype,i.CollectionView),n.extend(t.CompositeView.prototype,i.CompositeView),n.extend(t.Region.prototype,i.Region)}};i.ItemView={render:function(e){var n=this,i=r.Deferred();e=e||{},this.isClosed=!1;var s=function(){n.triggerMethod("before:render",n),n.triggerMethod("item:before:render",n);var i=n.getTemplate(),s=t.Renderer.render(i,n,e);r.when(s).then(o)},o=function(t){e.update||n.$el.html(t),n.bindUIElements(),u()},u=function(){n.triggerMethod("render",n),n.triggerMethod("item:rendered",n),i.resolve()};return s(),i.promise()}},i.CollectionView={render:function(){var e=this,t=r.Deferred(),n;this.isClosed=!1,this.triggerBeforeRender(),this.closeEmptyView(),this.closeChildren();if(this.collection&&this.collection.length>0)n=this.showCollection();else{var i=this.showEmptyView();n=[i]}return t.done(function(){e.triggerRendered()}),r.when.apply(this,n).then(function(){t.resolveWith(e)}),t.promise()},showCollection:function(){var e=this,t=[],n;return this.collection.each(function(r,i){n=e.getItemView();var s=e.addItemView(r,n,i);t.push(s)}),t},showEmptyView:function(n){var r,i=t.getOption(this,"emptyView");if(i&&!this._showingEmptyView){this._showingEmptyView=!0;var s=new e.Model;r=this.addItemView(s,i,0)}return r},renderItemView:function(e,t){var n=this,i=e.render();return r.when(i).then(function(){n.appendHtml(n,e,t)}),i}},i.CompositeView={render:function(){var e=this,t=r.Deferred();this.isClosed=!1,this.resetItemViewContainer();var n=this.renderModel();return r.when(n).then(function(n){e.$el.html(n),e.bindUIElements(),e.triggerMethod("composite:model:rendered");var i=e.renderCollection();r.when(i).then(function(){t.resolve()})}),t.done(function(){e.triggerMethod("composite:rendered")}),t.promise()},renderModel:function(){var e=this.getTemplate();return t.Renderer.render(e,this)},renderCollection:function(){var e=Array.prototype.slice.apply(arguments),n=t.CollectionView.prototype.render.apply(this,e);return n.done(function(){this.triggerMethod("composite:collection:rendered")}),n.promise()}},i.Region={show:function(e,n){var i=this,s,o=r.Deferred();n=n||{};var u=function(){i.open(e),t.triggerMethod.call(e,"show"),t.triggerMethod.call(i,"show",e),o.resolve()};return this.ensureEl(),this.close(),s=e.render(n),r.when(s).then(u),this.currentView=e,o.promise()}},i.Renderer={render:function(e,t,r){var i={update:!1};return n.extend(i,r),i.replace===!0?e.view(t,!0):e.html(t.$el,t,i.update)}};var s=function(e,t,i){var s;e&&(s=e.call(i)),r.when(s).then(n.bind(t,i))};return i.init(),i}(n,n.Marionette,t,window.jQuery||window.Zepto||window.ender),n.Marionette.Async});